<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BAC Tracker</title>
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BAC Tracker">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>BAC Tracker</h1>
      <p class="tagline">Track BAC, nutrition, and recovery timing. Educational use only. Never drive after drinking.</p>
    </header>

    <nav class="app-tabs" aria-label="Main tabs">
      <button type="button" class="tab-btn active" data-tab="current">Live Track</button>
      <button type="button" class="tab-btn" data-tab="history">History</button>
      <button type="button" class="tab-btn" data-tab="social">Social</button>
      <button type="button" class="tab-btn" data-tab="account">Account</button>
    </nav>

    <section class="tab-panel active" id="tab-current">
      <section class="setup card" id="setup-section" style="display: none;">
        <h2>Quick setup (one time)</h2>
        <div class="row">
          <label>
            Weight (lb)
            <input type="number" id="weight" min="80" max="400" value="160" step="1">
          </label>
          <label>
            Sex
            <select id="sex">
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </label>
        </div>
        <button type="button" class="btn btn-primary btn-block" id="btn-setup">Start</button>
      </section>

      <section class="tracking card" id="tracking-section" style="display: none;">
        <h2 class="section-title">Live now</h2>
        <div class="safety-banner" id="safety-banner">
          <p class="safety-banner-title">Safety first</p>
          <p class="safety-banner-body">Educational estimate only. Never drive after drinking. Use emergency actions if anyone is at risk.</p>
        </div>
        <div class="quick-add" id="quick-add"></div>

        <details class="more-options" id="more-options" open>
          <summary class="more-options-title">More drink options</summary>
          <div class="add-custom">
            <label for="drink-search">Find a drink fast</label>
            <input type="search" id="drink-search" placeholder="Search beer, liquor, cocktail, brand..." autocomplete="off">
            <div class="friend-actions drink-filter-chips" id="drink-filter-chips">
              <button type="button" class="chip active drink-filter" data-category="all">All</button>
              <button type="button" class="chip drink-filter" data-category="beer">Beer</button>
              <button type="button" class="chip drink-filter" data-category="seltzer">Seltzer</button>
              <button type="button" class="chip drink-filter" data-category="wine">Wine</button>
              <button type="button" class="chip drink-filter" data-category="liquor">Liquor</button>
              <button type="button" class="chip drink-filter" data-category="cocktail">Cocktails</button>
            </div>
            <label for="drink-catalog">Drink</label>
            <select id="drink-catalog" aria-label="Choose drink"></select>
            <div class="add-buttons">
              <button type="button" class="btn btn-add" data-count="1">+1</button>
              <button type="button" class="btn btn-add" data-count="2">+2</button>
              <button type="button" class="btn btn-add" data-count="3">+3</button>
            </div>
            <div class="time-ago-toggle">
              <span class="time-ago-label">Had it earlier?</span>
              <div class="time-ago-chips" id="time-ago-chips">
                <button type="button" class="chip active" data-hours="0">Now</button>
                <button type="button" class="chip" data-hours="0.5">30 min</button>
                <button type="button" class="chip" data-hours="1">1 hr</button>
                <button type="button" class="chip" data-hours="2">2 hr</button>
              </div>
            </div>
          </div>
        </details>

        <div class="stats stats-primary" id="stats">
          <div class="stat stat-primary"><span class="stat-value" id="bac-now">0.000</span><span class="stat-label">BAC %</span></div>
          <div class="stat stat-primary"><span class="stat-value" id="sober-in">-</span><span class="stat-label">Sober at</span></div>
          <div class="stat stat-primary"><span class="stat-value" id="drive-pill">Checking...</span><span class="stat-label">Drive status</span></div>
        </div>
        <div class="stats stats-secondary">
          <div class="stat"><span class="stat-value" id="drinks-logged">0</span><span class="stat-label">Drinks</span></div>
          <div class="stat"><span class="stat-value" id="total-calories">0</span><span class="stat-label">Cal</span></div>
          <div class="stat"><span class="stat-value" id="total-carbs">0</span><span class="stat-label">Carbs</span></div>
          <div class="stat"><span class="stat-value" id="total-sugar">0</span><span class="stat-label">Sugar</span></div>
        </div>

        <div class="drive-card card-lite">
          <h3>Can I drive?</h3>
          <p class="mini-help">Conservative estimate only. If unsure, do not drive.</p>
          <p class="drive-status" id="drive-status">No data yet</p>
          <p class="drive-message" id="drive-message">Log drinks to see conservative guidance.</p>
          <p class="drive-action" id="drive-action"></p>
          <div class="friend-actions">
            <button type="button" class="btn btn-secondary" id="btn-drive-ride">Get a ride</button>
            <button type="button" class="btn btn-danger" id="btn-drive-911">Call 911</button>
            <button type="button" class="btn btn-secondary" id="btn-drive-share">Share status</button>
          </div>
        </div>

        <div class="chart-card card-lite">
          <div class="chart-head">
            <h3>BAC trend</h3>
            <p class="mini-help">Watch your curve, legal-limit line, and timing estimates.</p>
            <p class="mini-help" id="chart-pace-metric">Pace: -- drinks/hr</p>
          </div>
          <div class="friend-actions">
            <button type="button" class="chip active chart-mode" data-mode="full">Full night</button>
            <button type="button" class="chip chart-mode" data-mode="last6">Last 6h</button>
            <button type="button" class="chip chart-mode" data-mode="untilSober">Until sober</button>
            <button type="button" class="chip" id="btn-chart-pace">Show pace projection</button>
          </div>
          <div class="chart-insights" id="chart-insights">
            <div class="mini-card"><p class="mini-title">Peak BAC</p><p class="mini-value" id="peak-bac">0.000</p></div>
            <div class="mini-card"><p class="mini-title">Below 0.08 in</p><p class="mini-value" id="below-legal-in">-</p></div>
            <div class="mini-card"><p class="mini-title">Risk zone now</p><p class="mini-value" id="risk-zone">None</p></div>
          </div>
          <p class="mini-help" id="chart-timeline-hints">Keep this chart simple: current BAC curve plus legal-limit context.</p>
          <div class="chart-wrap chart-wrap-large"><canvas id="bac-chart" aria-label="BAC over time"></canvas></div>
        </div>

        <div class="risk-alert card-lite" id="risk-alert" style="display:none;">
          <h3>Immediate safety alert</h3>
          <p class="group-summary" id="risk-alert-message"></p>
          <div class="friend-actions">
            <button type="button" class="btn btn-danger" id="btn-emergency-911">Call 911 now</button>
            <button type="button" class="btn btn-secondary" id="btn-risk-ride">Call ride/campus help</button>
          </div>
        </div>

        <details class="accordion card-lite" open>
          <summary>Planning tools</summary>
          <div class="accordion-body">
            <h3>Smart pace coach</h3>
            <p class="mini-help" id="pace-prediction">Loading pace prediction...</p>
            <div class="hangover-card">
              <h3>Need to be sharp later?</h3>
              <div class="target-inputs">
                <label>Date<input type="date" id="target-date"></label>
                <label>Time<input type="time" id="target-time" step="900"></label>
              </div>
              <div class="friend-actions">
                <button type="button" class="chip" id="btn-target-tonight">Tonight 11:00 PM</button>
                <button type="button" class="chip" id="btn-target-tomorrow">Tomorrow 8:00 AM</button>
              </div>
              <p class="group-summary" id="target-summary"></p>
              <div id="hangover-result" class="hangover-result" style="display: none;">
                <p class="hangover-risk" id="hangover-risk"></p>
                <p class="hangover-stop" id="hangover-stop"></p>
                <p class="hangover-message" id="hangover-message"></p>
              </div>
            </div>
          </div>
        </details>

        <details class="accordion card-lite" open>
          <summary>Safety tools</summary>
          <div class="accordion-body">
            <h3>Safety actions</h3>
            <label>
              Campus preset
              <select id="campus-preset"></select>
            </label>
            <div class="friend-actions">
              <button type="button" class="chip danger" id="btn-sos-911">Call 911</button>
              <button type="button" class="chip" id="btn-sos-ride">Need ride</button>
              <button type="button" class="chip" id="btn-sos-call-friend">Call friend</button>
              <button type="button" class="chip" id="btn-sos-share-location">Share location</button>
              <button type="button" class="chip" id="btn-sos-campus-help">Campus help</button>
            </div>
            <p class="group-summary" id="sos-status"></p>
            <div class="night-tools">
              <h3>All-night tools</h3>
              <div class="night-grid">
                <div class="mini-card">
                  <p class="mini-title">Hydration</p>
                  <p class="mini-value" id="water-progress">0 / 0 oz</p>
                  <p class="mini-help" id="water-hint">Add water to pace the night.</p>
                  <button type="button" class="btn btn-add-water" id="btn-add-water">+8 oz water</button>
                </div>
                <div class="mini-card">
                  <p class="mini-title">Pace coach</p>
                  <p class="mini-help" id="pace-coach">Log drinks to get pacing advice.</p>
                </div>
              </div>
            </div>
          </div>
        </details>

        <button type="button" class="btn btn-secondary btn-block" id="btn-reset">Clear all drinks</button>
        <button type="button" class="btn btn-primary btn-block" id="btn-share-app">Share app with friends</button>
        <details class="accordion card-lite">
          <summary>Logged drinks</summary>
          <div class="accordion-body">
            <p class="mini-help">Review your entries. You can edit time/drink count or remove an entry.</p>
            <p class="group-summary" id="events-undo"></p>
            <div id="session-events-list" class="friend-list"></div>
          </div>
        </details>
      </section>
    </section>

    <section class="tab-panel" id="tab-history">
      <section class="saved-sessions card-lite">
        <h3>Saved sessions</h3>
        <p class="mini-help">Pick a date to browse and load previous sessions into your current view.</p>
        <div class="chart-insights">
          <div class="mini-card"><p class="mini-title">Sessions shown</p><p class="mini-value" id="hist-total-sessions">0</p></div>
          <div class="mini-card"><p class="mini-title">Avg drinks</p><p class="mini-value" id="hist-avg-drinks">0.0</p></div>
          <div class="mini-card"><p class="mini-title">Max drinks</p><p class="mini-value" id="hist-max-drinks">0</p></div>
        </div>
        <div class="friend-add">
          <label class="sr-only" for="session-date">Session date</label>
          <input type="date" id="session-date">
          <button type="button" class="btn btn-secondary" id="btn-session-today">Today</button>
        </div>
        <div id="session-date-list" class="friend-actions"></div>
        <div class="friend-add">
          <label class="sr-only" for="session-name">Session name</label>
          <input type="text" id="session-name" maxlength="80" placeholder="Name this session">
          <button type="button" class="btn btn-primary" id="btn-save-session">Save</button>
        </div>
        <div class="friend-add">
          <button type="button" class="btn btn-secondary" id="btn-session-export">Export CSV</button>
        </div>
        <p class="group-summary" id="session-status"></p>
        <div id="saved-session-list" class="friend-list"></div>
      </section>
      <section class="card-lite">
        <h3>Session debrief</h3>
        <p class="mini-help">Get a quick summary of your current active session and safer-next-time suggestions.</p>
        <button type="button" class="btn btn-secondary" id="btn-session-debrief">Generate debrief</button>
        <pre id="debrief-content" class="group-summary">No debrief yet.</pre>
      </section>
    </section>

    <section class="tab-panel" id="tab-social">
      <section class="card">
        <h2>Social</h2>
        <p class="mini-help">Only approved friends can see your data, and only if you enable sharing.</p>
        <div class="friend-add">
          <label class="sr-only" for="social-group-name">New group name</label>
          <input type="text" id="social-group-name" maxlength="60" placeholder="Create group (e.g. Friday Out)">
          <button type="button" class="btn btn-primary" id="btn-social-create-group">Create</button>
        </div>
        <div class="friend-add">
          <label class="sr-only" for="social-group-code">Invite code</label>
          <input type="text" id="social-group-code" maxlength="12" placeholder="Join with invite code">
          <button type="button" class="btn btn-secondary" id="btn-social-join-group">Join</button>
        </div>
        <p class="group-summary" id="social-request-status"></p>

        <div class="card-lite">
          <h3>Groups</h3>
          <div id="social-group-list" class="friend-list"></div>
          <p class="group-summary" id="social-active-group-label"></p>
        </div>

        <div class="card-lite">
          <h3>Sharing & location</h3>
          <div class="feedback-actions">
            <button type="button" class="btn btn-secondary" id="btn-group-share-toggle">Enable group sharing</button>
          </div>
          <div class="friend-add">
            <label class="sr-only" for="social-location-note">Location note</label>
            <input type="text" id="social-location-note" maxlength="80" placeholder="Optional location/status (e.g. Library lot)">
            <button type="button" class="btn btn-secondary" id="btn-social-location">Update</button>
          </div>
          <p class="group-summary" id="social-share-status">Select a group first.</p>
        </div>

        <div class="card-lite">
          <h3>Safety alerts</h3>
          <div id="social-alerts-list" class="friend-list"></div>
          <button type="button" class="chip" id="btn-social-toggle-alerts">Show all alerts</button>
        </div>

        <details class="accordion card-lite">
          <summary>Members</summary>
          <div class="accordion-body">
            <div id="social-members-list" class="friend-list"></div>
          </div>
        </details>

        <details class="accordion card-lite">
          <summary>Guardian links</summary>
          <div class="accordion-body">
            <div class="friend-add">
              <label class="sr-only" for="social-guardian-label">Guardian label</label>
              <input type="text" id="social-guardian-label" maxlength="40" placeholder="Example: Mom">
              <button type="button" class="btn btn-primary" id="btn-social-create-guardian">Create link</button>
            </div>
            <div id="social-guardian-list" class="friend-list"></div>
          </div>
        </details>

        <details class="accordion card-lite">
          <summary>Friend network</summary>
          <div class="accordion-body">
            <p class="mini-help">Use username lookup or share your invite link by text for one-tap friend add.</p>
            <div class="friend-add">
              <label class="sr-only" for="social-lookup-username">Lookup username</label>
              <input type="text" id="social-lookup-username" maxlength="24" placeholder="Find by username (example: noah123)">
              <button type="button" class="btn btn-secondary" id="btn-social-lookup-user">Lookup</button>
            </div>
            <p class="group-summary" id="social-lookup-result"></p>
            <div class="friend-add">
              <label class="sr-only" for="social-friend-email">Friend email or username</label>
              <input type="text" id="social-friend-email" placeholder="friend@example.com or username">
              <button type="button" class="btn btn-primary" id="btn-social-add-friend">Send request</button>
            </div>
            <div class="friend-add">
              <button type="button" class="btn btn-secondary" id="btn-copy-invite-link">Copy my invite link</button>
            </div>
            <p class="group-summary" id="my-friend-profile"></p>
            <div id="social-requests-list" class="friend-list"></div>
            <div id="social-friends-list" class="friend-list"></div>
          </div>
        </details>

        <div class="card-lite">
          <h3>Live friend feed</h3>
          <div id="social-feed-list" class="friend-list"></div>
        </div>
      </section>
    </section>

    <section class="tab-panel" id="tab-account">
      <section class="auth card" id="auth-section">
        <h2>Account</h2>
        <p class="mini-help" id="auth-status">Signed in.</p>

        <div class="card-lite">
          <h3>Profile</h3>
          <div class="row">
            <label>Name<input type="text" id="acct-display-name" maxlength="40" placeholder="Your name"></label>
            <label>Username<input type="text" id="acct-username" maxlength="24" placeholder="username"></label>
          </div>
          <div class="row">
            <label>Gender
              <select id="acct-gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </label>
            <label>Weight (lb)<input type="number" id="acct-weight" min="80" max="400" step="1" placeholder="160"></label>
          </div>
          <button type="button" class="btn btn-primary" id="btn-acct-save">Save profile</button>
          <p class="group-summary" id="acct-status"></p>
        </div>

        <div class="card-lite">
          <h3>Preferences</h3>
          <p class="mini-help">Control sharing defaults for friend feed visibility.</p>
          <button type="button" class="btn btn-secondary" id="btn-acct-share-toggle">Enable friend sharing</button>
          <p class="group-summary" id="acct-share-status"></p>
        </div>

        <div class="card-lite">
          <h3>Privacy summary</h3>
          <p class="mini-help" id="acct-privacy-summary">Loading privacy settings...</p>
          <p class="mini-help legal-link"><a href="/privacy">View Privacy Policy</a></p>
        </div>

        <div class="card-lite">
          <h3>Emergency contacts</h3>
          <p class="mini-help">Add people you want quick access to when you need help.</p>
          <div class="friend-add">
            <label class="sr-only" for="emergency-name">Name</label>
            <input type="text" id="emergency-name" maxlength="50" placeholder="Contact name">
            <label class="sr-only" for="emergency-phone">Phone</label>
            <input type="text" id="emergency-phone" maxlength="30" placeholder="Phone number">
            <button type="button" class="btn btn-primary" id="btn-emergency-add">Add</button>
          </div>
          <p class="group-summary" id="emergency-status"></p>
          <div id="emergency-list" class="friend-list"></div>
        </div>

        <div class="feedback-actions">
          <button type="button" class="btn btn-secondary" id="btn-logout">Log out</button>
        </div>

        <div class="card-lite">
          <h3>Privacy center</h3>
          <p class="mini-help">Revoke all sharing and guardian links instantly.</p>
          <button type="button" class="btn btn-secondary btn-block" id="btn-privacy-revoke-all">Revoke all sharing</button>
          <p class="group-summary" id="privacy-status"></p>
        </div>

        <div class="card-lite">
          <h3>Onboarding</h3>
          <p class="mini-help" id="onboarding-status">Loading onboarding steps...</p>
        </div>

        <div class="card-lite danger-zone">
          <h3>Danger zone</h3>
          <p class="mini-help">Permanently delete your account and all saved data.</p>
          <div class="row">
            <label>Password
              <input type="password" id="acct-delete-password" autocomplete="current-password" placeholder="Current password">
            </label>
            <label>Type DELETE
              <input type="text" id="acct-delete-confirm" maxlength="6" placeholder="DELETE">
            </label>
          </div>
          <button type="button" class="btn btn-danger" id="btn-account-delete">Delete account</button>
          <p class="group-summary" id="acct-delete-status"></p>
        </div>
      </section>
    </section>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
